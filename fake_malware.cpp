#include <random>
#include <stdio.h>
#include <stdlib.h>
#include <iostream>
#include <string.h>
#include <dirent.h>
#include <windows.h>

using namespace std;

//Prototipos__ini
void writter(string);
void gotoxy(int,int);
void load_screen();
void block_window();
void list_dir(string);
void list_infected(string);
void virus_symbol(int,int);
void show_errors();
//Prototipos__fin

int main(){
    system("cls");
    block_window();
    //
	char sound_brokenHDD[] = "./sounds/brokenHDD.wav";
	char sound_winerrors[] = "./sounds/WindowsError.wav";
    string principal_greeting = "Hi, I\'m Tim and I will be your personal assistant today.\n"\
                                "While downloading the configuration files and updating your OS "\
                                "[ winmediaplayer-16.0.32.dll, winclient_dnsconfig-4.4.16-E12.dll ] "\
                                "I will help you in the installation.\n";
	writter(principal_greeting);
    //
    system("cls");
	system("start DNS_NETping.bat");
    list_dir("C:/Program Files/");
    list_dir("C:/Windows/");
	system("cls");
	load_screen();
	system("start error_log1.bat");
	system("start error_log1.bat");
	system("start error_log1.bat");
	system("start error_log1.bat");
	system("start error_log1.bat");
	system("start error_log1.bat");
	cout<<PlaySound((LPCSTR)sound_brokenHDD, NULL, SND_FILENAME);
	system("start error_log1.bat");
	system("start error_log2.bat");
	system("start error_log2.bat");
	system("start error_log2.bat");
    cout<<PlaySound((LPCSTR)sound_winerrors, NULL, SND_FILENAME);
	//
	show_errors();
    //
    cout<<"\033[0;97m";
	gotoxy(87,10); printf("HACKING %s's PC | Please take a sit meanwhile...");
	gotoxy(80,11); printf("HACKING %s's mail [%s] | Please take a sit meanwhile...");
	virus_symbol(10,5);
	list_infected("C:/Program Files/");
	//
    return 0;
}

//writter
void writter(string str){
    int n = 0;
    for (int i = 0; i < str.length(); i++){
        char c = str[i];
        switch (c){
            case '.': n = 250; break;
            case ',': n = 120; break;
            case ' ': n = 30; break;
            default : n = 10;
        }
        cout<<str[i];
        Sleep(n);
    }
}

//show_errors
void show_errors(){
	system("winError2.vbs");
	for (int i=0; i<312; i++){
		int r = (rand()-987123)%123876;
		cout<<"\033[1;32m"<<"Error "<<r<<"_windowsSystem32Error"<<((r*r)-57)-(2*r);
	}
}

//gotoxy
void gotoxy(int x, int y){
	HANDLE hcon;
	hcon = GetStdHandle(STD_OUTPUT_HANDLE);
	COORD dwPos;
	dwPos.X = x;
	dwPos.Y= y;
	SetConsoleCursorPosition(hcon,dwPos);
}

//block_window
void block_window() {
    keybd_event(VK_MENU, 0x38, 0, 0);
    keybd_event(VK_RETURN, 0x1c, 0, 0);
    keybd_event(VK_RETURN, 0x1c, KEYEVENTF_KEYUP, 0);
    keybd_event(VK_MENU, 0x38, KEYEVENTF_KEYUP, 0);
    //
    return;
}

//list_dir
void list_dir(string dir) {
    DIR *directory;
    struct dirent *element;
    string e;
    //
    load_screen();
    if (directory = opendir(dir.c_str())) { 
    	cout<<"\033[0;97m"<<"							";writter("ANALIZANDO DIRECTORIO");cout<<" ";writter(dir);cout<<endl;
        while(element = readdir(directory)) {
		    e = element->d_name;
			if ( (e!=".") && (e!="..") ){
	            cout<<"\033[1;31m"<<"        Analizando directorio:\t\t"<<"\033[0;97m";writter(e);cout<<endl;
	            Sleep(60);
	            cout<<"\033[1;32m"<<"        ---> Proceso completado con exito..!"<<endl;
                Sleep(20);
	        }
        }
    }
    cout<<"\033[0;97m"<<endl<<endl;
    for(int i=0; i<=255; i++){
    	printf("\t\t\t\t\t\tLoading... %c\r\r",i);
		Sleep(10);
	}
    closedir(directory);
    system("cls");
    gotoxy(30,25);
    printf("\t\t\t\tALL DIRECTORIES HAS BEEN "\
			"\033[1;32m"\
			"SCANNED "\
			"SUCCESSFULY\n"\
			"\033[0;97m\n");
    for(int i=5; i>=0; i--){
    	printf("\t\t\t\t\t\t\t\t\t\t%02d:%02d\r",0,i);
    	Sleep(1000);
	}
    system("cls");
}

//list_dir INFECTED
void list_infected(string dir) {
    DIR *directory;
    struct dirent *element;
    string e;
    string infecteds[999];
    int x=0;
    if (directory = opendir(dir.c_str())) {
        while(element = readdir(directory)) {
		    e = element->d_name;
			if ( (e!=".") && (e!="..") ){
				infecteds[x] = e;
			}
	        x++;
        }
        gotoxy(80,23); printf("Directorio: %s",dir.c_str());
	    for(int i=0; i < sizeof(infecteds); i++){
	    	if( infecteds[i] != ""  &&  infecteds[i] != " " ){
		        gotoxy(80,25); cout<<"\033[1;31m"<<infecteds[i+0]<<"\033[1;32m"<<"		[OK]";
		    	gotoxy(80,26); cout<<"\033[1;31m"<<infecteds[i+1]<<"\033[1;32m"<<"		[OK]";
		    	gotoxy(80,27); cout<<"\033[1;31m"<<infecteds[i+2]<<"\033[1;32m"<<"		[OK]";
		    	gotoxy(80,28); cout<<"\033[1;31m"<<infecteds[i+3]<<"\033[1;32m"<<"		[OK]";
		    	gotoxy(80,29); cout<<"\033[1;31m"<<infecteds[i+4]<<"\033[1;32m"<<"		[OK]";
		    	gotoxy(80,30); cout<<"\033[1;31m"<<infecteds[i+5]<<"\033[1;32m"<<"		[OK]";
		    	//
		    	Sleep(150);
		    	//
		    	gotoxy(80,25); cout<<"                                                                    ";
		    	gotoxy(80,26); cout<<"                                                                    ";
		    	gotoxy(80,27); cout<<"                                                                    ";
		    	gotoxy(80,28); cout<<"                                                                    ";
		    	gotoxy(80,29); cout<<"                                                                    ";
		    	gotoxy(80,30); cout<<"                                                                    ";
			}
		}
    }
}

// load_screen
void load_screen(){
	int MAX=255;
	for(int i=0; i<=MAX; i++){
		printf("\033[1;31m");
		gotoxy(50,20);
		printf("Loading... %c",i);
		if(i < 50){	
			printf("\033[0;97m");
			gotoxy(35,23);
			printf("[------------------------------------]\t%d%c",i/2, 37);
		}
		if(i>=50 && i<=100){
			printf("\033[0;97m");
			gotoxy(35,23);
			printf("[##########--------------------------]\t%d%c",i/2, 37);
		}
		if(i>100 && i<=200){
			printf("\033[0;97m");
			gotoxy(35,23);
			printf("[####################----------------]\t%d%c",(i/2)-2, 37);
		}
		if(i>200 && i<=249){
			printf("\033[0;97m");
			gotoxy(35,23);
			printf("[############################--------]\t98%c", 37);
		}
		if(i==255){
			printf("\033[1;32m");
			gotoxy(35,23);
			printf("[####################################]\t100%c", 37);
		}
		Sleep(30);
	}	
	printf("\033[1;32m");
	gotoxy(52,25);
	printf("DONE");
	Sleep(2000);
	system("cls");
}

//virus_symbol
void virus_symbol(int x, int y){
	gotoxy(x+0,y+0);  printf("                                                                     ");
	gotoxy(x+0,y+1);  printf("                      18888888888888888888888887                     ");
	gotoxy(x+0,y+2);  printf("                   18888817               78888887                   ");
	gotoxy(x+0,y+3);  printf("                 88887                         18887                 ");
	gotoxy(x+0,y+4);  printf("                888                               888                ");
	gotoxy(x+0,y+5);  printf("              788                                  788               ");
	gotoxy(x+0,y+6);  printf("             788                                     88              ");
	gotoxy(x+0,y+7);  printf("             88                                       88             ");
	gotoxy(x+0,y+8);  printf("            881                                    7  88             ");
	gotoxy(x+0,y+9);  printf("            88  88                                 88  88            ");
	gotoxy(x+0,y+10); printf("            88  88                                 88  88            ");
	gotoxy(x+0,y+11); printf("            88  88                                 88  88            ");
	gotoxy(x+0,y+12); printf("            887 881                               881 788            ");
	gotoxy(x+0,y+13); printf("             88  88                               88  88             ");
	gotoxy(x+0,y+14); printf("             887 88     7718887       7888177     88 188             ");
	gotoxy(x+0,y+15); printf("              88 88  88888888887     18888888888  88788              ");
	gotoxy(x+0,y+16); printf("               8888 888888888888     888888888888 8888               ");
	gotoxy(x+0,y+17); printf("                888 78888888888       88888888887 887         7      ");
	gotoxy(x+0,y+18); printf("    78888       187  888888888         888888888  781      18888     ");
	gotoxy(x+0,y+19); printf("    88 7887     88    8888881    8 8    8888888    88     888  88    ");
	gotoxy(x+0,y+20); printf("    88   881    88      711    788 88     117     788    888   88    ");
	gotoxy(x+0,y+21); printf("  1887    88881  88            888 888            88  88888    1887  ");
	gotoxy(x+0,y+22); printf(" 881        7888888881        8888 8881       7188888888         888 ");
	gotoxy(x+0,y+23); printf(" 881718881      1888888881    8888 8881    1888888881      888811888 ");
	gotoxy(x+0,y+24); printf("  888888888887      8888888    88   88    8888881      188888888888  ");
	gotoxy(x+0,y+25); printf("           188888    8811 88             88 8788   7888881           ");
	gotoxy(x+0,y+26); printf("              78888877818 888117771771118887888 188888               ");
	gotoxy(x+0,y+27); printf("                  78888718778 878 8 818781 8 888887                  ");
	gotoxy(x+0,y+28); printf("                     88  8818181878781818888 181                     ");
	gotoxy(x+0,y+29); printf("                  188881 1818 878 8 87878887 888888                  ");
	gotoxy(x+0,y+30); printf("              188888  88   788888181888887   88 7888881              ");
	gotoxy(x+0,y+31); printf("     788888888881     888                   887     188888888887     ");
	gotoxy(x+0,y+32); printf("     88   111      78888881               88888887      117  788     ");
	gotoxy(x+0,y+33); printf("     188        188881   888887      7188888   188881       7881     ");
	gotoxy(x+0,y+34); printf("       888    88887        188888888888887        78888    888       ");
	gotoxy(x+0,y+35); printf("        88   887                                     188   88        ");
	gotoxy(x+0,y+36); printf("        887188                                        7887188        ");
	gotoxy(x+0,y+37); printf("         8888                                           8888         ");
	gotoxy(x+0,y+38); printf("                                                                     ");
}
